<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Management</title>
     <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: "Poppins", sans-serif;
             font-style: normal;
            background-color: var(--bg-light);
            color: var(--text-dark);
            scroll-behavior: smooth;
            box-sizing: border-box;
        }
         /* modified navbar */
       :root {
            /* Primary Colors (University Branding) */
            --primary: #003366; /* Deep Blue - main brand color */
            --primary-light: #1a4d80; /* Lighter shade for hover states */
            --primary-dark: #00264d; /* Darker shade for active states */
            
            /* Secondary Colors */
            --secondary: #FFD700; /* Gold - for accents and highlights */
            --secondary-light: #ffe44d;
  
            /* Background Colors */
            --bg-light: #FFFFFF;
            --bg-gray: #F5F5F5;
            
            /* Text Colors */
            --text-dark: #333333;
            --text-black: #000000;
            --text-light: #FFFFFF;
            
            /* Status Colors */
            --success: #4CAF50;
            --error: #F44336;
            --warning: #FFC107;
            --info: #17A2B8;

             /* Typography */
            --heading-1: 3rem;
            --heading-2: 1.7rem;
            --body-text: 1.1rem;
            --small-text: 0.85rem;
            --line-height: 1.6;
            
            /* Spacing */
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
        }
        section {
            padding-top: 3rem;
            padding-bottom: 3rem;
            scroll-margin-top: 70px; /* Account for fixed navbar */
        }
        

        /* Navbar Styles */
        .navbar {
            background-color: var(--primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand, .nav-link {
            color: var(--text-light) !important;
            font-weight: 500;
        }

        .nav-link:hover {
            color: var(--secondary) !important;
            border-bottom: 2px solid var(--secondary);
        }

        .dropdown-menu {
            background-color: var(--primary-light);
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .dropdown-item {
            color: var(--text-light);
            padding: 10px 20px;
        }

        .dropdown-item:hover {
            background-color: var(--secondary) !important;
            color: var(--text-dark) !important;
            border-radius: 8px;
        }
        /* Remove Bootstrap's default active background */
.dropdown-item.active {
    background: transparent !important;
}

/* Ensure hover works in all states */
.dropdown-item:hover {
    background-color: var(--secondary) !important;
    color: var(--text-dark) !important;
    border-radius: 8px;
}
         
        .uni-logo {
            height: 50px;
            width: 50px;
            border-radius: 8px;
            margin-right: 15px;
        }

        .custom-nav-spacing .nav-item {
            margin-right: 2rem;
        }

        @media (max-width: 991.98px) {
            .custom-nav-spacing .nav-item {
                margin-right: 0;
                margin-bottom: 0.5rem;
            }
        }

        .logout-button {
            border-radius: 10px;
            width: 70px;
            height: 50px;
            background-color: var(--error);
        }

        .logout-icon {
            font-size: 1.7rem;
            width: 20px;
        }

        .logout-icon:hover {
            color: var(--secondary) !important;
        }
        /* modified navbar */

        .title-main {
           font-size: var(--heading-1); /* modified*/
            font-weight: 700;
            color: var(--primary);
            text-align: center;
           margin: var(--space-xl) 0 var(--space-lg) 0; /* modified */
            letter-spacing: 1px;
             margin-top: 8rem; /*modified*/
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.2rem 2rem 1.2rem;
            background: var(--bg-gray); /* modified */
        }
        .faculty-actions-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.2rem;
            flex-wrap: wrap;
        }
        .search-box {
            position: relative;
           width: 240px; /*modified width*/
            min-width: 0;
            flex-shrink: 1;
        }
        .search-box input {
            width: 100%;
            padding: 11px 20px 11px 38px; /* modified */
            border: 1.5px solid #2563eb;
            border-radius: 2rem;
            font-size: 1.09rem;
            background: var(--bg-gray); /* modified */
            color: var(--primary); /* modified */
            transition: border 0.2s;
            outline: none;
        }
        .search-box input:focus {
           border-color: var(--primary-dark); /*modified */
            background: #e6eeff;
        }
        .search-box .fa-search {
            position: absolute;
            left: 13px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary); /* modified */
            font-size: 1.18rem;
            opacity: 0.8;
        }
        .add-faculty-btn {
            background: linear-gradient(90deg,var(--primary) 60%, var(--primary-light) 100%); /*modified*/
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.09);
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .add-faculty-btn:hover,
        .add-faculty-btn:focus {
            background: linear-gradient(90deg, var(--primary-dark) 60%, var(--primary) 100%); /*modified*/
            color: var(--text-light); /* modified */
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.13);
        }
        .faculty-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.2rem 2.2rem;
        }
        @media (max-width: 800px) {
            .faculty-list {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 0 0.5rem 2rem 0.5rem;
            }
            .search-box {
                width: 100%;
                margin-top: 1rem;
            }
        }
        .faculty-card {
            background: var(--bg-light); /* modified */
            border-radius: 1rem;/*modified*/
            box-shadow: 0 8px 32px rgba(80, 82, 73, 0.13); /*modified*/
            padding: 2.2rem 2.2rem 1.6rem 2.2rem;
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
            position: relative;
            transition: box-shadow 0.2s, transform 0.2s;
            min-width: 0;
            font-size: 1.13rem;
        }
        .faculty-card:hover {
            box-shadow: 0 8px 32px rgba(37,99,235,0.13);
            transform: translateY(-4px) scale(1.01);
        }
        .faculty-card .faculty-actions {
            position: absolute;
            top: 18px;
            right: 18px;
            display: flex;
            gap: 0.7rem;
            opacity: 0;
            transition: opacity 0.18s;
            z-index: 2;
        }
        .faculty-card:hover .faculty-actions {
            opacity: 1;
        }
        .faculty-action-icon {
            background: #e6eeff;
            color: #2563eb;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            border: none;
            outline: none;
            margin-bottom: 5px;
        }
                /* modified icon color */
                .faculty-action-icon .edit-btn {
            background: rgba(13, 110, 253, 0.1);  /* Light blue background */
            color: #0d6efd;                       /* Bootstrap-style blue */
            border: 1px solid rgba(13, 110, 253, 0.2);
        }
        .edit-btn:hover {
            background: var(--primary-light);                 /* Solid blue */
            color: white;
        }

        /* DELETE BUTTON - Standard Red */
        .delete-btn {
            background: rgba(220, 53, 69, 0.1);   /* Light red background */
            color: #dc3545;                       /* Bootstrap-style red */
            border: 1px solid rgba(220, 53, 69, 0.2);
        }

        .delete-btn:hover {
            background: #dc3545;                  /* Solid red */
            color: white;
        }
        /* modified icon color */

        .faculty-header-row {
            display: flex;
            align-items: center;
            gap: 1.2rem;
        }
        .faculty-image {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary); /* modified */
            background: var(--bg-gray); /* modified */
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
            flex-shrink: 0;
        }
        .faculty-main-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            min-width: 0;
        }
        .faculty-name {
            font-size: var(--heading-2); /* modified */
            font-weight: 700;
            color: var(--primary); /* modified */
            margin: 0.1rem 0;
            letter-spacing: 0.2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .faculty-head {
            font-size: var(--body-text); /* modified */
            color: var(--primary-dark); /* modified */
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .faculty-head .fa-user-tie {
            color: var(--secondary); /* modified */
            font-size: 1.18rem;
        }
        .faculty-contact-row {
            display: flex;
            gap: 1.2rem;
            flex-wrap: wrap;
            margin-top: 0.2rem;
        }
        .faculty-contact {
            font-size: var(--small-text); /* modified */
            color:  var(--text-dark); /* modified */
            display: flex;
            align-items: center;
            gap: 0.4rem;
            opacity: 0.95;
        }
        /* modified icon color*/
        .faculty-contact .fa-envelope{ 
            color: var(--info);
            font-size: 1.13rem;
        }
        .faculty-contact .fa-phone{
            color: var(--success);
            font-size: 1.13rem;
        }
        .faculty-contact .fa-location-dot {
            color: var(--primary); /* modified */
            font-size: 1.13rem;
        }
        /* modified icon color */

        .faculty-description {
            font-size: var(--body-text); /* modified */
            color: var(--text-dark); /* modified */
            background: var(--bg-gray); /* modified */
            border-radius: 0.8rem;
            padding: 1.2rem 1.3rem;
            line-height: 1.7;
            min-height: 70px;
            max-height: 140px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.2rem;
            font-family: 'Poppins', sans-serif;
            transition: max-height 0.2s;
        }
        .faculty-description.description-full {
            max-height: 600px;
            overflow: auto;
        }
        .read-more-btn {
            background: none;
            color: var(--primary); /* modified */
            border: none;
            font-size: 1.13rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 0.2rem;
            margin-left: 0;
            padding: 0;
            transition: color 0.2s;
        }
        .read-more-btn:hover {
            color: var(--primary-dark); /* modified */
            text-decoration: underline;
        }

        /* modified mobile view */
        @media (max-width: 800px) {
    /* Add click effect for mobile cards */
    .faculty-card {
        transition: box-shadow 0.3s ease, transform 0.3s ease;
        cursor: pointer;
    }
    .faculty-card:active {
    transform: scale(0.98);
}
}
/* modified mobile view */
        /* Edit Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(30, 41, 59, 0.18);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #fff;
            border-radius: 1.2rem;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.13);
            padding: 2.7rem 2.7rem 1.7rem 2.7rem;
            min-width: 340px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 1.2rem;
            position: relative;
        }
        .modal-content h3 {
            font-size: var(--heading-2); /* modified*/
            font-weight: 600;
            color: var(--primary); /* modified */
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .modal-content .profile-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.7rem;
        }
        .modal-content .profile-input .icon {
            font-size: 1.7rem;
            color: #2563eb;
            margin-bottom: 0.2rem;
        }
        .modal-content .profile-preview {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 0.2rem;
            border: 2px dashed #2563eb;
            background: #f7faff;
        }
        .modal-content input, .modal-content select, .modal-content textarea {
            width: 100%;
            padding: 13px 16px;
            margin: 7px 0;
            border: 1.5px solid #2563eb;
            border-radius: 7px;
            font-size: 1.13rem;
            background: #f7faff;
            color: #2563eb;
            transition: border 0.2s;
            outline: none;
            font-family: 'Poppins', sans-serif;
        }
        .modal-content input[type="file"] {
            padding: 0;
            background: #f7faff;
            border: none;
            font-size: 1.13rem;
        }
        .modal-content input[type="file"]::-webkit-file-upload-button,
        .modal-content input[type="file"]::file-selector-button {
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 18px;
            font-size: 1.13rem;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            margin-right: 10px;
            transition: background 0.2s;
        }
        .modal-content input[type="file"]:hover::-webkit-file-upload-button,
        .modal-content input[type="file"]:hover::file-selector-button {
            background: #1e40af;
        }
        .modal-content textarea {
            min-height: 110px;
            max-height: 350px;
            resize: vertical;
            font-family: 'Poppins', sans-serif;
        }
        .modal-content textarea:focus {
            border-color: #1e40af;
            background: #e6eeff;
        }
        .modal-content .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .modal-content .button-group button {
            background: linear-gradient(90deg, #2563eb 60%, #4eafff 100%);
            color: #fff;
            border: none;
            padding: 12px 28px;
            border-radius: 7px;
            cursor: pointer;
            font-size: 1.13rem;
            font-weight: 600;
            transition: background 0.2s;
        }
        .modal-content .button-group button.cancel-btn {
            background: #f7faff;
            color: #2563eb;
            border: 1.5px solid #2563eb;
        }
        .modal-content .button-group button.cancel-btn:hover {
            background: #e6eeff;
            color: #1e40af;
        }
        .modal-content .button-group button:hover {
            background: linear-gradient(90deg, #1e40af 60%, #2563eb 100%);
        }
        /* Head of Faculty Select Popup */
        .head-popup-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(30, 41, 59, 0.18);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .head-popup {
            background: #fff;
            border-radius: 1.2rem;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.13);
            padding: 2.2rem 2rem 1.5rem 2rem;
            min-width: 320px;
            max-width: 800px;
            width: 100%;
            max-height: 70vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 1.2rem;
            position: relative;
        }
        .head-popup-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2563eb;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .head-popup-search {
            width: 100%;
            padding: 10px 16px;
            border: 1.5px solid #2563eb;
            border-radius: 7px;
            font-size: 1.13rem;
            background: #f7faff;
            color: #2563eb;
            margin-bottom: 0.7rem;
            font-family: 'Poppins', sans-serif;
        }
        .head-popup-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.1rem 1.1rem;
        }
        @media (max-width: 900px) {
            .head-popup-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 600px) {
            .head-popup-list {
                grid-template-columns: 1fr;
            }
        }
        .head-popup-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.9rem 1.2rem;
            border-radius: 0.7rem;
            background: #f7faff;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s;
            border: 2px solid transparent;
        }
        .head-popup-item:hover,
        .head-popup-item.selected {
            background: #e6eeff;
            border-color: #2563eb;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.09);
        }
        .head-popup-img {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #2563eb;
            background: #fff;
        }
        .head-popup-name {
            font-size: 1.13rem;
            color: #222;
            font-weight: 500;
        }
        .head-popup-nores {
            text-align: center;
            color: #64748b;
            padding: 1.2rem 0;
            font-size: 1.13rem;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target=".navbar" data-bs-offset="180" tabindex="0"> 
<!--modified Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <img src="https://www.ucsy.edu.mm/img/ucsylogo-icpc2017.png" class="uni-logo ms-4" alt="University Logo">

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav" >
                
                <ul class="navbar-nav ms-auto align-items-center custom-nav-spacing">

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            University Info
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#university-info"><i class="fas fa-info-circle me-2"></i> Overview</a></li>
                            <li><a class="dropdown-item" href="#executives"><i class="fas fa-user-tie me-2"></i> Executives</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Academics
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#faculties">Faculties</a></li>
                            <li><a class="dropdown-item" href="#departments">Departments</a></li>
                            <li><a class="dropdown-item" href="#degrees">Degrees</a></li>
                            <li><a class="dropdown-item" href="#instructors">Instructors</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Resources
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#partnerships"><i class="fas fa-handshake me-2"></i> Partnerships</a></li>
                            <li><a class="dropdown-item" href="#certificates"><i class="fas fa-certificate me-2"></i> Certificates</a></li>
                            <li><a class="dropdown-item" href="#labs"><i class="fas fa-flask me-2"></i> Labs</a></li>
                        </ul>
                    </li>

                    <li class="nav-item logout">
                        <a class="nav-link logout-icon" href="logout.html" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- modified navbar -->

    <div class="title-main">Department Management</div>
    <div class="container py-3">
        <div class="faculty-actions-row mb-3">
            <button class="add-faculty-btn" onclick="openAddModal()" title="Add New Department"><i class="fa fa-plus"></i></button>
            <div class="search-box">
                <i class="fa fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search departments..." onkeyup="searchFaculties()">
            </div>
        </div>
        <div class="faculty-list" id="departmentList">
            <!-- Department Cards -->
            {% for dept in departments %}
            <div class="faculty-card" data-name="{{dept.name}}">
                <div class="faculty-actions">
                    <button class="faculty-action-icon edit-btn" onclick="openEditModal('{{dept.name|escapejs}}', '{{dept.email|escapejs}}', '{{dept.phone|escapejs}}', '{{dept.location|escapejs}}', '{{dept.description|escapejs}}', '{{dept.head|escapejs}}', `{{dept.photo|escapejs}}`, '{{dept.id|escapejs}}', '{{dept.faculty_id|escapejs}}')"><i class="fa fa-pen"></i></button>
                    <button class="faculty-action-icon delete-btn" onclick="confirmDelete('{{dept.name}}', '{{dept.id}}')"><i class="fa fa-trash"></i></button>
                </div>
                <div class="faculty-name">{{dept.name}}</div> <!--modified name-->
                <div class="faculty-header-row">
                    <img src="{{dept.photo}}" alt="{{dept.name}}" class="faculty-image">
                    <div class="faculty-main-info">
                        
                        <div class="faculty-head"><i class="fa fa-user-tie"></i> Head: <span>{{dept.head}}</span></div>
                        <div class="faculty-contact-row">
                            <div class="faculty-contact"><i class="fa fa-envelope"></i> {{dept.email}}</div>
                            <div class="faculty-contact"><i class="fa fa-phone"></i> {{dept.phone}}</div>
                            <div class="faculty-contact"><i class="fa fa-location-dot"></i>{{dept.location}}</div>
                        </div>
                        <div class="faculty-contact" style="margin-top:0.5rem;">
                            <i class="fa fa-university"></i>
                            Faculty: <span class="faculty-faculty-name">{{dept.faculty_name}}</span>
                        </div>
                    </div>
                </div>
                <div class="faculty-description description-truncate">
                    {{dept.description}}
                </div>
                <button class="read-more-btn" onclick="toggleDescription(this)">Read more</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Edit Department Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>Edit Department</h3>
            <div class="profile-input">
                <span class="icon"><i class="fa fa-user-circle"></i></span>
                <input type="file" id="departmentImage" accept="image/*" onchange="previewImage(event, 'departmentImagePreview')">
                <img id="departmentImagePreview" class="profile-preview" src="https://via.placeholder.com/240x180?text=Photo" alt="Department Image">
            </div>
            <input type="text" id="departmentName" placeholder="Department Name">
            <input type="email" id="departmentEmail" placeholder="Email">
            <input type="text" id="departmentPhone" placeholder="Phone">
            <input type="text" id="departmentLocation" placeholder="Location">
            <textarea id="departmentDescription" placeholder="Description"></textarea>
            <div style="display:flex;align-items:center;gap:0.7rem;">
                <input type="text" id="headOfDepartmentDisplay" placeholder="Head of Department" readonly style="flex:1;cursor:pointer;background:#f7faff;" onclick="openHeadPopup('edit')">
                <button type="button" class="faculty-action-icon" style="background:#e6eeff;" onclick="openHeadPopup('edit')" title="Select Head"><i class="fa fa-user-tie"></i></button>
            </div>
            <select id="departmentFacultySelect" style="margin-top:10px;">
                <option value="" readonly>Select Faculty</option>
                {% for fac in faculties %}
                    <option value="{{fac.id}}">{{fac.name}}</option>
                {% endfor %}
            </select>
            <div class="button-group">
                <button class="cancel-btn" onclick="closeModal('editModal')">Cancel</button>
                <button onclick="saveDepartment()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Department Modal -->
    <form id="departmentForm" action="" method="POST">
    {% csrf_token %}
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3>Add New Department</h3>
            <div class="profile-input">
                <span class="icon"><i class="fa fa-user-circle"></i></span>
                <input type="file" id="newDepartmentImage" accept="image/*" onchange="previewImage(event, 'newDepartmentImagePreview')">
                <img id="newDepartmentImagePreview" class="profile-preview" src="https://via.placeholder.com/240x180?text=Photo" alt="New Department Image">
            </div>
            <input type="text" id="newDepartmentName" placeholder="Department Name">
            <input type="email" id="newDepartmentEmail" placeholder="Email">
            <input type="text" id="newDepartmentPhone" placeholder="Phone">
            <input type="text" id="newDepartmentLocation" placeholder="Location">
            <textarea id="newDepartmentDescription" placeholder="Description"></textarea>
            <div style="display:flex;align-items:center;gap:0.7rem;">
                <input type="text" id="newHeadOfDepartmentDisplay" placeholder="Head of Department" readonly style="flex:1;cursor:pointer;background:#f7faff;" onclick="openHeadPopup('add')">
                <button type="button" class="faculty-action-icon" style="background:#e6eeff;" onclick="openHeadPopup('add')" title="Select Head"><i class="fa fa-user-tie"></i></button>
            </div>
            <select id="newDepartmentFacultySelect" style="margin-top:10px;">
                <option value="">Select Faculty</option>
                {% for fac in faculties %}
                    <option value="{{fac.id}}">{{fac.name}}</option>
                {% endfor %}
            </select>
            <div class="button-group">
                <button class="cancel-btn" onclick="closeModal('addModal')">Cancel</button>
                <button onclick="addDepartment()">Add</button>
            </div>
        </div>
    </div>
    </form>

    <!-- Head of Faculty Select Popup -->
    <div id="headPopup" class="head-popup-backdrop" style="display:none;">
        <div class="head-popup">
            <div class="head-popup-title">Select Head of Faculty</div>
            <input type="text" class="head-popup-search" id="headPopupSearch" placeholder="Search users...">
            <div class="head-popup-list" id="headPopupList">
                <!-- User list will be rendered here -->
            </div>
        </div>
    </div>

     <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample users for head of faculty selection
        // const users = [
        //     { name: "John Doe", img: "https://mamcollegeofpharmacy.ac.in/images/faculty.jpg" },
        //     { name: "Jane Smith", img: "https://mamcollegeofpharmacy.ac.in/images/faculty.jpg" },
        //     { name: "Priya Singh", img: "https://randomuser.me/api/portraits/women/44.jpg" },
        //     { name: "Amit Kumar", img: "https://randomuser.me/api/portraits/men/32.jpg" },
        //     { name: "Sara Lee", img: "https://randomuser.me/api/portraits/women/68.jpg" },
        //     { name: "David Brown", img: "https://randomuser.me/api/portraits/men/65.jpg" }
        // ];

         //modified navbar js
         // Function to navigate to lab details page
        function navigateToLabDetails(labId) {
            window.location.href = `lab-details.html?id=${labId}`;
        }
        
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

       
document.addEventListener('DOMContentLoaded', function() {
  // Get all navbar links (including dropdown items)
  const navLinks = document.querySelectorAll('.dropdown-item');
  
  // Get the navbar collapse element
  const navbarCollapse = document.querySelector('.navbar-collapse');
  
  // Add click event to each link
  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      // Check if navbar is expanded (mobile view)
      if (navbarCollapse.classList.contains('show')) {
        // Trigger the collapse
        const toggleBtn = document.querySelector('.navbar-toggler');
        if (toggleBtn) {
          toggleBtn.click(); // Simulate click on toggle button
        }
      }
    });
  });
});

        //modified navbar js

        let instructors = '{{instructors|escapejs}}';
        instructors = instructors.replaceAll("'", '"');
        // alert(instructors);
        console.log(instructors);
        instructors = JSON.parse(instructors);
        let headPopupTarget = null;
        const  users = instructors;

        function toggleDescription(button) {
            const desc = button.parentElement.querySelector('.faculty-description');
            if (desc.classList.contains('description-truncate')) {
                desc.classList.remove('description-truncate');
                desc.classList.add('description-full');
                button.textContent = 'Read less';
            } else {
                desc.classList.remove('description-full');
                desc.classList.add('description-truncate');
                button.textContent = 'Read more';
            }
        }

        function openEditModal(name, email, phone, location, description, head, image, id, faculty_id) {
            document.getElementById('departmentName').value = name;
            document.getElementById('departmentEmail').value = email;
            document.getElementById('departmentPhone').value = phone;
            document.getElementById('departmentLocation').value = location;
            document.getElementById('departmentDescription').value = description;
            document.getElementById('departmentImagePreview').src = image;
            document.getElementById('headOfDepartmentDisplay').value = head;
            document.getElementById('departmentFacultySelect').value = faculty_id;
            document.getElementById('editModal').style.display = 'flex';
            headPopupTarget = 'edit';
            sessionStorage.setItem('editing-department', id);
        }

        function openAddModal() {
            document.getElementById('newDepartmentName').value = '';
            document.getElementById('newDepartmentEmail').value = '';
            document.getElementById('newDepartmentPhone').value = '';
            document.getElementById('newDepartmentLocation').value = '';
            document.getElementById('newDepartmentDescription').value = '';
            document.getElementById('newDepartmentImagePreview').src = 'https://via.placeholder.com/240x180?text=Photo';
            document.getElementById('newHeadOfDepartmentDisplay').value = '';
            document.getElementById('addModal').style.display = 'flex';
            headPopupTarget = 'add';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- Faculty CRUD AJAX logic ---
        // --- Add Department ---
        function addDepartment() {
            if (confirm('Are you sure to add this')) {
                const name = document.getElementById('newDepartmentName').value.trim();
                const email = document.getElementById('newDepartmentEmail').value.trim();
                const phone = document.getElementById('newDepartmentPhone').value.trim();
                const location = document.getElementById('newDepartmentLocation').value.trim();
                const description = document.getElementById('newDepartmentDescription').value.trim();
                const headName = document.getElementById('newHeadOfDepartmentDisplay').value.trim();
                let headId = "";
                if (headName) {
                    const userObj = (window.instructors || []).find(u => u.name === headName);
                    headId = userObj ? userObj.id : "";
                }
                const facultyId = document.getElementById('newDepartmentFacultySelect').value;
                const photoInput = document.getElementById('newDepartmentImage');
                const photo = photoInput.files[0];

                const formData = new FormData();
                formData.append('name', name);
                formData.append('email', email);
                formData.append('phone', phone);
                formData.append('location', location);
                formData.append('description', description);
                formData.append('head', sessionStorage.getItem('dept_head'));
                formData.append('faculty', facultyId);
                sessionStorage.removeItem('dept_head');
                if (photo) formData.append('photo', photo);

                fetch('/executives/api/department/add/', {
                    method: 'POST',
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/executives/show_department_management';
                    } else {
                        alert('Failed to add department: ' + (data.error || 'Unknown error'));
                    }
                });
            }
        }

        // --- Edit Department ---
        function openEditModalData(id) {
            fetch(`/executives/api/department/list/`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const department = data.departments.find(f => f.id === id);
                        if (department) {
                            editingDepartmentId = id;
                            document.getElementById('departmentName').value = department.name;
                            document.getElementById('departmentEmail').value = department.email;
                            document.getElementById('departmentPhone').value = department.phone;
                            document.getElementById('departmentLocation').value = department.location;
                            document.getElementById('departmentDescription').value = department.description;
                            document.getElementById('departmentImagePreview').src = department.photo || 'https://via.placeholder.com/240x180?text=Photo';
                            document.getElementById('headOfDepartmentDisplay').value = department.head;
                            document.getElementById('editModal').style.display = 'flex';
                        }
                    }
                });
        }

        function saveDepartment() {
            if (!confirm("Are you sure to save the edited department data?")) return;
            const name = document.getElementById('departmentName').value.trim();
            const email = document.getElementById('departmentEmail').value.trim();
            const phone = document.getElementById('departmentPhone').value.trim();
            const location = document.getElementById('departmentLocation').value.trim();
            const description = document.getElementById('departmentDescription').value.trim();
            const headName = document.getElementById('headOfDepartmentDisplay').value.trim();
            let headId = "";
            if (headName) {
                const userObj = (window.instructors || []).find(u => u.name === headName);
                headId = userObj ? userObj.id : "";
            }
            const facultyId = document.getElementById('departmentFacultySelect').value;
            const photoInput = document.getElementById('departmentImage');
            const photo = photoInput.files[0];
            const editingDepartmentId = sessionStorage.getItem('editing-department');

            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('phone', phone);
            formData.append('location', location);
            formData.append('description', description);
            formData.append('head', sessionStorage.getItem('dept_head'));
            formData.append('faculty', facultyId);
            if (photo) formData.append('photo', photo);
            // alert(email + phone + location + sessionStorage.getItem('dept_head') + facultyId); return;

            fetch(`/executives/api/department/edit/${editingDepartmentId}/`, {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert('Failed to edit department: ' + (data.error || 'Unknown error'));
                    window.location.reload();
                }
            });
        }

        // --- Delete Department ---
        function confirmDelete(name, id) {
            if (confirm(`Are you sure you want to delete ${name}?`)) {
                fetch(`/executives/api/department/delete/${id}/`, {
                    method: 'POST'
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert('Failed to delete department: ' + (data.error || 'Unknown error'));
                    }
                });
            }
        }

        function previewImage(event, previewId) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(previewId).src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function searchFaculties() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const facultyCards = document.querySelectorAll('.faculty-card');
            facultyCards.forEach(card => {
                const name = card.getAttribute('data-name').toLowerCase();
                if (name.includes(input)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Head of Faculty Popup
        function openHeadPopup(mode) {
            document.getElementById('headPopup').style.display = 'flex';
            renderHeadPopupList('');
            document.getElementById('headPopupSearch').value = '';
            document.getElementById('headPopupSearch').focus();
            headPopupTarget = mode;
        }
        document.getElementById('headPopupSearch').oninput = function() {
            renderHeadPopupList(this.value);
        };
        function renderHeadPopupList(filter) {
            const list = document.getElementById('headPopupList');
            list.innerHTML = '';
            const filtered = users.filter(u => !filter || u.name.toLowerCase().includes(filter.toLowerCase()));
            if (!filtered.length) {
                const nores = document.createElement('div');
                nores.className = 'head-popup-nores';
                nores.textContent = 'No users found.';
                list.appendChild(nores);
                return;
            }
            filtered.forEach(user => {
                const item = document.createElement('div');
                item.className = 'head-popup-item';
                item.innerHTML = `
                    <img src="${user.img}" alt="${user.name}" class="head-popup-img">
                    <span class="head-popup-name">${user.name}</span>
                `;
                item.onclick = function() {
                    if (headPopupTarget === 'edit') {
                        sessionStorage.setItem('dept_head', user.id);
                        document.getElementById('headOfDepartmentDisplay').value = user.name;
                    } else {
                        sessionStorage.setItem('dept_head', user.id);
                        document.getElementById('newHeadOfDepartmentDisplay').value = user.name;
                    }
                    document.getElementById('headPopup').style.display = 'none';
                };
                list.appendChild(item);
            });
        }
        document.getElementById('headPopup').onclick = function(e) {
            if (e.target === this) this.style.display = 'none';
        };
    </script>
</body>
</html>