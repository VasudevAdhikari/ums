{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Mailbox</title>
    <link rel="stylesheet" href="{% static 'students/mailbox/styles/mailbox.css' %}">
    <link rel="stylesheet" href="{% static 'students/mailbox/styles/comments.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* ...existing styles... */
        /* Edit Post Modal Overlay */
        #editPostOverlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }
        #editPostOverlay.active { display: flex; }
        #editPostPopup {
            background: #fff;
            border-radius: 12px;
            max-width: 640px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            padding: 20px 28px 28px;
            font-family: 'Poppins', sans-serif;
            position: relative;
        }
        #editPostPopup h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-weight: 700;
            color: #333;
        }
        #postText {
            width: 100%;
            min-height: 100px;
            border-radius: 10px;
            border: 1.5px solid #ccc;
            padding: 12px 16px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
            margin-bottom: 0.5rem;
        }
        #postText:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px #007bff;
        }
        #mediaPreview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 20px;
            margin-bottom: 12px;
        }
        .media-tile {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
            background: #f9f9f9;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-tile img,
        .media-tile video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 10px;
        }
        .remove-media-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(0,0,0,0.6);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            line-height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            z-index: 10;
        }
        .remove-media-btn:hover {
            background: rgba(255,0,0,0.8);
        }
        #editPostPopup .buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 18px;
        }
        #addMediaBtn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 18px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 9px rgb(0 123 255 / 0.6);
            transition: background-color 0.3s ease;
            margin-bottom: 0.5rem;
        }
        #addMediaBtn:hover {
            background-color: #0056b3;
        }
        #savePostBtn {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 22px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 9px rgb(40 167 69 / 0.6);
            transition: background-color 0.3s ease;
            min-width: 90px;
        }
        #savePostBtn:hover {
            background-color: #19692c;
        }
        #closePopupBtn {
            position: absolute;
            top: 14px;
            right: 14px;
            background: transparent;
            border: none;
            font-size: 24px;
            font-weight: 700;
            line-height: 1;
            color: #333;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 1100;
        }
        #closePopupBtn:hover {
            color: #007bff;
        }
    </style>
    <!-- Add CSRF Token -->
    <script>
        const csrftoken = '{{ csrf_token }}';
        const current_page = '{{ current_page }}';
        console.log(current_page);
    </script>
</head>

<body>
    <div class="mailbox-banner">
        <img src="{% static 'students/mailbox/images/feed-image-1.png' %}" alt="Mailbox Banner">
        <div class="banner-overlay">
            <h1>Student Mailbox</h1>
        </div>
    </div>
    <br>


    <!-- Description Section -->
    <div class="mailbox-description">
        <p class="description-text">
            Welcome to the Student Mailbox - your central hub for academic discussions, resource sharing, and community
            engagement. Connect with fellow students, share your thoughts, and stay updated with the latest campus
            activities. This platform is designed to foster meaningful interactions and collaborative learning among
            students.
            <span class="more-text" style="display: none;">
                Whether you're looking to discuss course materials, organize study groups, or simply connect with peers,
                the Student Mailbox provides a safe and inclusive space for all academic-related conversations. Join our
                growing community and be part of an enriching educational experience.
            </span>
        </p>
        <button class="show-more-btn" type="button">Show More</button>
    </div>
    <div class="manage-post-container" onclick="window.location.href='/students/mailbox/'">
        <span class="manage-title">Back to Mailbox </span>
        <span class="manage-item">
            <i class="fa-solid fa-file-lines"></i>
            <span>Your Posts</span>
            <span class="manage-count manage-count-posts">{{ post_count|default:0 }}</span>
        </span>
        <span class="manage-item">
            <i class="fa-solid fa-hourglass-half"></i>
            <span>Pending Posts</span>
            <span class="manage-count manage-count-pending">{{ pending_count|default:0 }}</span>
        </span>
        <span class="manage-item">
            <i class="fa-solid fa-bell"></i>
            <span>Notifications</span>
            <span class="manage-count manage-count-notification">{{ notification_count|default:0 }}</span>
        </span>
    </div>
    <br>
    <div class="container">

        <div class="main-content" id="manage-posts-list">
            <!-- Posts will be loaded here dynamically by JS -->
            <div id="loading-indicator" style="text-align:center; display:none;">
                <span>Loading...</span>
            </div>
            <div id="no-more-posts" style="text-align:center; display:none;">
                <span>No more posts to show.</span>
            </div>
        </div>
    </div>

    <!-- Reaction Lightbox -->
    <div id="reaction-lightbox" class="reaction-lightbox" style="display:none;">
        <div class="reaction-lightbox-content">
            <span class="reaction-lightbox-close" style="cursor:pointer;float:right;font-size:2em;">&times;</span>
            <h2>All Reactions</h2>
            <div class="reaction-list"></div>
        </div>
    </div>

    <div class="copyright-footer">
        <p>Copyright 2021 MM Logic Gallery Youtube Channel</p>
    </div>
    <div id="image-lightbox" class="image-lightbox" style="display:none;">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-content">
            <img class="lightbox-img" src="" alt="Gallery Image" style="display: none;">
            <video class="lightbox-video" controls style="display: none;">
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        <span class="lightbox-prev">&#10094;</span>
        <span class="lightbox-next">&#10095;</span>
        <div class="lightbox-counter"></div>
    </div>

    <!-- Edit Post Modal Overlay -->
    <div id="editPostOverlay" aria-modal="true" role="dialog" aria-labelledby="editPostTitle" tabindex="-1" style="display:none;">
      <div id="editPostPopup">
        <button id="closePopupBtn" aria-label="Close edit post popup">&times;</button>
        <h2 id="editPostTitle">Edit Post</h2>
        <textarea id="postText" placeholder="Edit your post text here..."></textarea>
        <div id="mediaPreview" aria-label="Media preview section"></div>
        <button id="addMediaBtn" type="button">+ Add Media</button>
        <div class="buttons">
          <button id="savePostBtn" type="button">Save</button>
          <button id="cancelPostBtn" type="button" style="background:#e74c3c;color:#fff;border:none;border-radius:10px;padding:10px 22px;font-size:15px;font-weight:600;cursor:pointer;transition:background 0.2s;">Cancel</button>
        </div>
        <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display:none;" />
      </div>
    </div>

    <script>
        // Add static URLs as JavaScript variables
        const STATIC_URLS = {
            likeImage: "{% static 'students/mailbox/images/like.png' %}",
            commentsImage: "{% static 'students/mailbox/images/comments.png' %}",
            shareImage: "{% static 'students/mailbox/images/share.png' %}"
        };

        // Show More/Less logic for mailbox description
        document.addEventListener('DOMContentLoaded', function () {
            var showMoreBtn = document.querySelector('.show-more-btn');
            var moreText = document.querySelector('.more-text');
            if (showMoreBtn && moreText) {
                showMoreBtn.addEventListener('click', function () {
                    if (moreText.style.display === 'none' || moreText.style.display === '') {
                        moreText.style.display = 'inline';
                        showMoreBtn.textContent = 'Show Less';
                    } else {
                        moreText.style.display = 'none';
                        showMoreBtn.textContent = 'Show More';
                    }
                });
            }
        });
    </script>
    
    <script src="{% static 'students/mailbox/javascripts/managePosts.js' %}"></script>
    <script src="{% static 'students/mailbox/javascripts/mailbox2.js' %}"></script>
    <script src="{% static 'students/mailbox/javascripts/comments.js' %}"></script>
</body>

</html>